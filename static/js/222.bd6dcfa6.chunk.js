"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[222],{88993:(e,n,t)=>{t.r(n),t.d(n,{TestRunnerContext:()=>u,TestRunnerProvider:()=>l});var r=t(93460),o=t(46687),i=t(68743),u=(0,o.createContext)({itemValues:[]});function l(e){var n=e.children,t=(0,o.useState)([]),l=(0,r.default)(t,2),s=l[0],a=l[1],d=(0,o.useState)([]),c=(0,r.default)(d,2),v=c[0],f=c[1],y=(0,o.useState)(),p=(0,r.default)(y,2),m=p[0],b=p[1],h=(0,o.useState)(),_=(0,r.default)(h,2),g=_[0],k=_[1],O=(0,o.useState)(),w=(0,r.default)(O,2),j=w[0],D=w[1],T=(0,o.useState)(),S=(0,r.default)(T,2),V=S[0],x=S[1],R=(0,o.useState)(),P=(0,r.default)(R,2),C=P[0],$=P[1],E=(0,o.useState)(),I=(0,r.default)(E,2),F=I[0],N=I[1],A=(0,o.useMemo)((function(){return{itemValues:s,setItemValues:a,runnerTestCaseTitle:m,setRunnerTestCaseTitle:b,runnerDone:g,setRunnerDone:k,runningDeviceFeatures:j,setRunningDeviceFeatures:D,runningOneKeyDeviceFeatures:V,setRunningOneKeyDeviceFeatures:x,timestampBeginTest:C,setTimestampBeginTest:$,timestampEndTest:F,setTimestampEndTest:N,runnerLogs:v,setRunnerLogs:f}}),[s,g,v,m,j,V,C,F]);return(0,i.jsx)(u.Provider,{value:A,children:n})}},51798:(e,n,t)=>{t.r(n),t.d(n,{clearItemVerifyStateAtom:()=>c,itemVerifyStateAtom:()=>s,selectedItemVerifyStateAtom:()=>d,setItemVerifyStateAtom:()=>v});var r=t(36111),o=t(2400),i=t(71838);function u(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?u(Object(t),!0).forEach((function(n){(0,r.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var s=(0,o.atom)({}),a={verify:"none",error:void 0},d=function(e){return(0,i.selectAtom)(s,(function(n){return n[e]||a}))},c=(0,o.atom)(null,(function(e,n){var t=e(s),r=Object.keys(t).reduce((function(e,n){return e[n]=a,e}),{});n(s,r)})),v=(0,o.atom)(null,(function(e,n,t){var o=t.key,i=t.newState;n(s,(function(e){return l(l({},e),{},(0,r.default)({},o,i))}))}))},93302:(e,n,t)=>{t.r(n),t.d(n,{default:()=>s});var r=t(46687),o=t(1777),i=t(88993),u=t(38837),l=t(68743);function s(e){var n=e.onStop,t=e.onStart,s=(0,r.useContext)(i.TestRunnerContext),a=(0,o.default)();return(0,l.jsxs)(l.Fragment,{children:[!1!==s.runnerDone?(0,l.jsx)(u.Button,{variant:"primary",onPress:t,children:a.formatMessage({id:"action__start_test"})}):null,!1===s.runnerDone?(0,l.jsx)(u.Button,{variant:"destructive",onPress:n,children:a.formatMessage({id:"action__stop_test"})}):null]})}},69403:(e,n,t)=>{t.r(n),t.d(n,{TestRunnerView:()=>_});var r=t(63699),o=t(46687),i=t(75400),u=t(70892),l=t(51798),s=t(88993),a=t(68743),d=t(34103).StyleSheet.create({0:{flex:1},1:{width:"100%"}}),c=t(34103).View,v=(t(34103).Text,(0,o.memo)((function(e){var n=e.item,t=e.renderResultView,s=(0,o.useMemo)((function(){return(0,l.selectedItemVerifyStateAtom)(n.$key)}),[n.$key]),v=(0,u.useAtomValue)(s),f=(0,o.useMemo)((function(){var e;return null!=(e=null==v?void 0:v.verify)?e:"none"}),[v]),y=(0,o.useMemo)((function(){var e;return null!=(e=null==v?void 0:v.error)?e:""}),[v]),p=(0,o.useMemo)((function(){return y?(0,a.jsxs)(r.Text,{fontSize:14,color:"red",children:["error: ",y]}):null}),[y]),m=(0,o.useMemo)((function(){var e="gray";return"pending"===f?e="blue":"skip"===f?e="gray":"success"===f?e="green":"fail"===f?e="red":"warning"===f&&(e="orange"),(0,a.jsx)(r.Text,{width:80,color:e,fontWeight:"bold",children:f})}),[f]);return(0,a.jsxs)(i.XStack,{alignItems:"center",paddingVertical:"$2",gap:"$2",borderColor:"$border",borderWidth:"$px",children:[m,(0,a.jsxs)(c,{style:d[0],children:[t(n,v),p]})]})})));function f(e){var n=e.renderResultView,t=(0,o.useContext)(s.TestRunnerContext).itemValues;return(0,o.useMemo)((function(){return(0,a.jsx)(c,{style:d[1],children:t.map((function(e){return(0,a.jsx)(v,{renderResultView:n,item:e},e.$key)}))})}),[t,n])}var y=t(85985),p=t(34103).StyleSheet.create({0:{flexDirection:"column",gap:4}}),m=t(34103).View;t(34103).Text;function b(e){var n=e.title;return(0,a.jsx)(r.Text,{fontWeight:"bold",children:n})}function h(){var e=(0,o.useContext)(s.TestRunnerContext).runnerLogs;return void 0===e||0===e.length?null:(0,a.jsx)(y.default,{value:e.join("\n")})}function _(e){var n=e.title,t=e.renderExecuteView,r=e.renderResultView;return(0,a.jsx)(s.TestRunnerProvider,{children:(0,a.jsxs)(m,{style:p[0],children:[(0,a.jsx)(b,{title:n}),t(),(0,a.jsx)(h,{}),(0,a.jsx)(f,{renderResultView:r})]})})}},76847:(e,n,t)=>{t.r(n),t.d(n,{default:()=>v});var r=t(4088),o=t(77431),i=t(93460),u=t(46687),l=t(70892),s=t(12528),a=t(88993),d=t(51798),c=t(55298);function v(e){var n=e.fileName,t=void 0===n?"TestReport":n,v=e.reportTitle,f=void 0===v?"Test Report":v,y=e.customReport,p=(0,u.useContext)(a.TestRunnerContext),m=(0,l.useAtomValue)(d.itemVerifyStateAtom),b=(0,u.useState)(!1),h=(0,i.default)(b,2),_=h[0],g=h[1];(0,u.useEffect)((function(){g(!0===p.runnerDone)}),[p.runnerDone]);var k=function(){var e=(0,o.default)((function*(){var e=p.runnerTestCaseTitle,n=p.timestampBeginTest,o=p.timestampEndTest,i=p.itemValues,u=p.runningDeviceFeatures,l=p.runningOneKeyDeviceFeatures;if(m&&n&&o&&u){var a=new Date(n).toLocaleString(),d=new Date(o).toLocaleString(),v=i.every((function(e){var n=e.$key;return"success"===(null==m?void 0:m[n].verify)})),b=[];b.push(`# ${f} (${e})`),b.push(`Status: ${v?"Success":"Fail"}\n`),b.push(`Begin Time: ${a}\n`),b.push(`End Time: ${d}\n`),b.push(""),b.push("## Device Info");var h=(0,c.getDeviceInfo)(u,l);b.push("| Key | Value |"),b.push("| --- | --- |"),Object.keys(h).forEach((function(e){var n=h[e];n&&b.push(`| ${e} | ${n} |`)})),b.push("");var _=yield y(i,m);b.push.apply(b,(0,r.default)(_));var g=null==e?void 0:e.replace(/-/g,"_"),k=new Date(n).getTime(),O=`${t}(${g})${k}.md`;(0,s.downloadFile)(O,b.join("\n").toString())}}));return function(){return e.apply(this,arguments)}}();return{showExportReport:_,exportReport:k}}},21307:(e,n,t)=>{t.r(n),t.d(n,{useRunnerTest:()=>m});var r=t(36111),o=t(4088),i=t(77431),u=t(46687),l=t(28742),s=t(13620),a=t(70892),d=t(32718),c=t(19854),v=t(88993),f=t(51798);function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach((function(n){(0,r.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function m(e){var n=e.initTestCase,t=e.initHardwareListener,r=e.prepareRunner,y=e.prepareRunnerTestCase,m=e.prepareRunnerTestCaseDelay,h=e.generateRequestParams,_=e.processRequest,g=e.processResponse,k=e.removeHardwareListener,O=e.processRunnerDone,w=(0,u.useContext)(d.default).sdk,j=(0,c.useDevice)().selectedDevice,D=(0,u.useContext)(v.TestRunnerContext),T=D.setRunnerTestCaseTitle,S=D.setTimestampBeginTest,V=D.setTimestampEndTest,x=D.setRunnerDone,R=D.setRunningDeviceFeatures,P=D.setRunningOneKeyDeviceFeatures,C=D.setItemValues,$=D.setRunnerLogs,E=(0,a.useSetAtom)(f.setItemVerifyStateAtom),I=(0,a.useSetAtom)(f.clearItemVerifyStateAtom),F=(0,u.useRef)(!1),N=(0,u.useCallback)((function(){F.current=!1,null==C||C([]),null==I||I(),null==x||x(void 0),w&&(w.cancel(),null==k||k(w))}),[C,I,x,w,k]),A=(0,u.useCallback)((function(){F.current=!1,w&&(null==k||k(w)),null==V||V(Date.now()),null==x||x(!0),null==O||O()}),[w,O,k,x,V]);return{beginTest:(0,u.useCallback)((0,i.default)((function*(){try{var e,i,u;if(null==$||$([]),!w)return;w.removeAllListeners(l.UI_EVENT),yield null==t?void 0:t(w),F.current=!0,null==x||x(!1);var a=null!=(e=null==j?void 0:j.connectId)?e:"",d=yield w.getFeatures(a);if(!d.success)return void A();var c=null!=(i=null==(u=d.payload)?void 0:u.device_id)?i:"";null==R||R(d.payload);var v=d.payload;try{var f=yield w.getOnekeyFeatures(a);null==P||P(f.payload)}catch(J){}var k={printLog:function(e){null==$||$((function(n){return[].concat((0,o.default)(n),[e])}))},deviceFeatures:v,deviceId:c,connectId:a};yield null==r?void 0:r(a,c,v,w),null==S||S(Date.now());var O=yield n(k,w);if(!O)return;var D=O.title,V=O.data;null==T||T(D),null==C||C(V),null==I||I();for(var H=0;H<V.length;H++){var L=V[H];yield null==y?void 0:y(w,a,L);var B=yield null==m?void 0:m();if(B)yield b(B);else{var M=(0,l.getDeviceType)(v);("classic1s"===M||"pro"===M)&&(yield b(200))}try{yield new Promise((function(e){setTimeout((function(){return e(!0)}),200)}));var U=yield h(L),K=U.method,W=p({retryCount:1},U.params);null==E||E({key:L.$key,newState:{verify:"pending"}});var q=void 0,z=!1;if(_){var X,Y=yield _(w,K,a,c,W,L);q=Y.payload,z=null!=(X=Y.skipVerify)&&X}else q=yield w[`${K}`](a,c,W);if(!F.current)return;var G="none",J="",Q=void 0;if(q.success||z){var Z=yield g(q.payload,L,H,q);J=Z.error,Q=Z.ext,G=Z.verifyState?Z.verifyState:(0,s.isEmpty)(J)?"success":"fail"}else{var ee,ne,te;if(802===(null==(ee=q.payload)?void 0:ee.code)||803===(null==(ne=q.payload)?void 0:ne.code))G="skip";else G="fail",J=null==(te=q.payload)?void 0:te.error}null==E||E({key:L.$key,newState:{verify:G,error:J,ext:Q}})}catch(oe){var re;null==E||E({key:L.$key,newState:{verify:"fail",error:null!=(re=null==oe?void 0:oe.message)?re:""}})}}A()}catch(oe){console.log("error",oe),N()}})),[$,w,t,x,null==j?void 0:j.connectId,R,r,S,n,T,C,I,A,P,y,m,h,E,_,g,N]),stopTest:N}}function b(e){return new Promise((function(n){setTimeout((function(){return n(!0)}),e)}))}},76005:(e,n,t)=>{t.r(n),t.d(n,{HardwareInputPinDialogProvider:()=>v,useHardwareInputPinDialog:()=>f});var r=t(36111),o=t(93460),i=t(46687),u=t(28742),l=t(18494),s=t(68743);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){(0,r.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var c=(0,i.createContext)(void 0),v=function(e){var n=e.children,t=(0,i.useState)({isOpen:!1,sdk:void 0}),r=(0,o.default)(t,2),a=r[0],v=r[1],f=(0,i.useCallback)((function(){var e;null==(e=a.sdk)||e.uiResponse({type:u.UI_RESPONSE.RECEIVE_PIN,payload:"@@ONEKEY_INPUT_PIN_IN_DEVICE"})}),[a.sdk]),y=(0,i.useCallback)((function(e,n){(0,u.supportInputPinOnSoftware)(n).support?v({isOpen:!0,sdk:e}):f()}),[f]),p=(0,i.useCallback)((function(){v((function(e){return d(d({},e),{},{isOpen:!1,sdk:void 0})}))}),[]),m=(0,i.useCallback)((function(e){var n;null==(n=a.sdk)||n.uiResponse({type:u.UI_RESPONSE.RECEIVE_PIN,payload:e}),p()}),[p,a.sdk]),b=(0,i.useCallback)((function(){var e;null==(e=a.sdk)||e.cancel()}),[a.sdk]),h=(0,i.useMemo)((function(){return{dialogState:a,openDialog:y,closeDialog:p}}),[a,y,p]);return(0,s.jsxs)(c.Provider,{value:h,children:[n,(0,s.jsx)(l.ReceivePin,{open:a.isOpen,onOpenChange:function(e){v((function(n){return d(d({},n),{},{isOpen:e})}))},onConfirm:function(e){return m(e)},onSwitchDevice:f,onCancel:b})]})},f=function(){var e=(0,i.useContext)(c);if(void 0===e)throw new Error("useEventDialog must be used within an EventDialogProvider");return e}},55298:(e,n,t)=>{t.r(n),t.d(n,{getDeviceBasicInfo:()=>o,getDeviceInfo:()=>i});var r=t(28742);function o(e,n){var t,o,i,u=(null==(t=(0,r.getDeviceType)(e))?void 0:t.toUpperCase())||"UNKNOWN",l=e&&(0,r.getDeviceUUID)(e),s=(null==n?void 0:n.onekey_ble_build_id)||(null==e?void 0:e.onekey_ble_build_id),a=`${null==e?void 0:e.ble_ver}-${s}`,d=(null==n?void 0:n.onekey_boot_build_id)||(null==e?void 0:e.onekey_boot_build_id),c=e&&`${null==(o=(0,r.getDeviceBootloaderVersion)(e))?void 0:o.join(".")}-${d}`,v=e&&`${null==e?void 0:e.onekey_board_version}-${null==n?void 0:n.onekey_board_build_id}`,f=(null==n?void 0:n.onekey_firmware_build_id)||(null==e?void 0:e.onekey_firmware_build_id);return{deviceType:u,serialNumber:l,bleVersion:a,bootloaderVersion:c,boardloaderVersion:v,firmwareVersion:e&&`${null==(i=(0,r.getDeviceFirmwareVersion)(e))?void 0:i.join(".")}-${f}`}}function i(e,n){var t=o(e,n),r=t.deviceType,i=t.serialNumber,u=t.bleVersion,l=t.bootloaderVersion,s=t.boardloaderVersion,a=t.firmwareVersion,d=(null==n?void 0:n.onekey_firmware_hash)||(null==e?void 0:e.onekey_firmware_hash),c=(null==n?void 0:n.onekey_boot_hash)||(null==e?void 0:e.onekey_boot_hash)||(null==e?void 0:e.bootloader_hash),v=(null==n?void 0:n.onekey_se01_build_id)||(null==e?void 0:e.onekey_se01_build_id),f=`${(null==e?void 0:e.onekey_se01_version)||(null==e?void 0:e.se_ver)}-${v}`,y=null==n?void 0:n.onekey_se01_hash,p=null==n?void 0:n.onekey_se02_build_id,m=`${null==e?void 0:e.onekey_se02_version}-${p}`,b=null==n?void 0:n.onekey_se02_hash,h=null==n?void 0:n.onekey_se03_build_id,_=`${null==e?void 0:e.onekey_se03_version}-${h}`,g=null==n?void 0:n.onekey_se03_hash,k=null==n?void 0:n.onekey_se04_build_id,O=`${null==e?void 0:e.onekey_se04_version}-${k}`,w=null==n?void 0:n.onekey_se04_hash;return{deviceType:r,serialNumber:i,boardloaderVersion:s,boardloaderHash:(null==n?void 0:n.onekey_board_hash)||(null==e?void 0:e.onekey_board_hash),bootloaderVersion:l,bootloaderHash:c,se01Version:f,se01Hash:y,se02Version:m,se02Hash:b,se03Version:_,se03Hash:g,se04Version:O,se04Hash:w,firmwareVersion:a,firmwareHash:d,bleVersion:u,bleHash:(null==n?void 0:n.onekey_ble_hash)||(null==e?void 0:e.onekey_ble_hash)}}},12528:(e,n,t)=>{function r(e,n){var t=document.createElement("a"),r=new Blob([n],{type:"text/plain"});t.href=URL.createObjectURL(r),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}t.r(n),t.d(n,{downloadFile:()=>r})}}]);