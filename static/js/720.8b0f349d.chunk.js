"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[720],{76005:(e,o,t)=>{t.r(o),t.d(o,{HardwareInputPinDialogProvider:()=>_,useHardwareInputPinDialog:()=>f});var r=t(36111),i=t(93460),a=t(46687),n=t(28742),s=t(18494),l=t(68743);function d(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?d(Object(t),!0).forEach((function(o){(0,r.default)(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var u=(0,a.createContext)(void 0),_=function(e){var o=e.children,t=(0,a.useState)({isOpen:!1,sdk:void 0}),r=(0,i.default)(t,2),d=r[0],_=r[1],f=(0,a.useCallback)((function(){var e;null==(e=d.sdk)||e.uiResponse({type:n.UI_RESPONSE.RECEIVE_PIN,payload:"@@ONEKEY_INPUT_PIN_IN_DEVICE"})}),[d.sdk]),p=(0,a.useCallback)((function(e,o){(0,n.supportInputPinOnSoftware)(o).support?_({isOpen:!0,sdk:e}):f()}),[f]),v=(0,a.useCallback)((function(){_((function(e){return c(c({},e),{},{isOpen:!1,sdk:void 0})}))}),[]),b=(0,a.useCallback)((function(e){var o;null==(o=d.sdk)||o.uiResponse({type:n.UI_RESPONSE.RECEIVE_PIN,payload:e}),v()}),[v,d.sdk]),h=(0,a.useCallback)((function(){var e;null==(e=d.sdk)||e.cancel()}),[d.sdk]),y=(0,a.useMemo)((function(){return{dialogState:d,openDialog:p,closeDialog:v}}),[d,p,v]);return(0,l.jsxs)(u.Provider,{value:y,children:[o,(0,l.jsx)(s.ReceivePin,{open:d.isOpen,onOpenChange:function(e){_((function(o){return c(c({},o),{},{isOpen:e})}))},onConfirm:function(e){return b(e)},onSwitchDevice:f,onCancel:h})]})},f=function(){var e=(0,a.useContext)(u);if(void 0===e)throw new Error("useEventDialog must be used within an EventDialogProvider");return e}},55298:(e,o,t)=>{t.r(o),t.d(o,{getDeviceBasicInfo:()=>i,getDeviceInfo:()=>a});var r=t(28742);function i(e,o){var t,i,a,n=(null==(t=(0,r.getDeviceType)(e))?void 0:t.toUpperCase())||"UNKNOWN",s=e&&(0,r.getDeviceUUID)(e),l=(null==o?void 0:o.onekey_ble_build_id)||(null==e?void 0:e.onekey_ble_build_id),d=`${null==e?void 0:e.ble_ver}-${l}`,c=(null==o?void 0:o.onekey_boot_build_id)||(null==e?void 0:e.onekey_boot_build_id),u=e&&`${null==(i=(0,r.getDeviceBootloaderVersion)(e))?void 0:i.join(".")}-${c}`,_=e&&`${null==e?void 0:e.onekey_board_version}-${null==o?void 0:o.onekey_board_build_id}`,f=(null==o?void 0:o.onekey_firmware_build_id)||(null==e?void 0:e.onekey_firmware_build_id);return{deviceType:n,serialNumber:s,bleVersion:d,bootloaderVersion:u,boardloaderVersion:_,firmwareVersion:e&&`${null==(a=(0,r.getDeviceFirmwareVersion)(e))?void 0:a.join(".")}-${f}`}}function a(e,o){var t=i(e,o),r=t.deviceType,a=t.serialNumber,n=t.bleVersion,s=t.bootloaderVersion,l=t.boardloaderVersion,d=t.firmwareVersion,c=(null==o?void 0:o.onekey_firmware_hash)||(null==e?void 0:e.onekey_firmware_hash),u=(null==o?void 0:o.onekey_boot_hash)||(null==e?void 0:e.onekey_boot_hash)||(null==e?void 0:e.bootloader_hash),_=(null==o?void 0:o.onekey_se01_build_id)||(null==e?void 0:e.onekey_se01_build_id),f=`${(null==e?void 0:e.onekey_se01_version)||(null==e?void 0:e.se_ver)}-${_}`,p=null==o?void 0:o.onekey_se01_hash,v=null==o?void 0:o.onekey_se02_build_id,b=`${null==e?void 0:e.onekey_se02_version}-${v}`,h=null==o?void 0:o.onekey_se02_hash,y=null==o?void 0:o.onekey_se03_build_id,g=`${null==e?void 0:e.onekey_se03_version}-${y}`,m=null==o?void 0:o.onekey_se03_hash,k=null==o?void 0:o.onekey_se04_build_id,x=`${null==e?void 0:e.onekey_se04_version}-${k}`,j=null==o?void 0:o.onekey_se04_hash;return{deviceType:r,serialNumber:a,boardloaderVersion:l,boardloaderHash:(null==o?void 0:o.onekey_board_hash)||(null==e?void 0:e.onekey_board_hash),bootloaderVersion:s,bootloaderHash:u,se01Version:f,se01Hash:p,se02Version:b,se02Hash:h,se03Version:g,se03Hash:m,se04Version:x,se04Hash:j,firmwareVersion:d,firmwareHash:c,bleVersion:n,bleHash:(null==o?void 0:o.onekey_ble_hash)||(null==e?void 0:e.onekey_ble_hash)}}},12528:(e,o,t)=>{function r(e,o){var t=document.createElement("a"),r=new Blob([o],{type:"text/plain"});t.href=URL.createObjectURL(r),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}t.r(o),t.d(o,{downloadFile:()=>r})},57720:(e,o,t)=>{t.r(o),t.d(o,{default:()=>ie});var r=t(77431),i=t(93460),a=t(46687),n=t(1900),s=t(56976),l=t(63699),d=t(9124),c=t(52456),u=t(94912),_=t(20368);const f={get name(){return"ExpoDocumentPicker"},getDocumentAsync:function(){var e=(0,r.default)((function*(e){var o=e.type,t=void 0===o?"*/*":o,i=e.multiple,a=void 0!==i&&i;if(!_.default.isDOMAvailable)return{canceled:!0,assets:null};var n=document.createElement("input");return n.style.display="none",n.setAttribute("type","file"),n.setAttribute("accept",Array.isArray(t)?t.join(","):t),n.setAttribute("id",String(Math.random())),a&&n.setAttribute("multiple","multiple"),document.body.appendChild(n),new Promise((function(e,o){n.addEventListener("change",(0,r.default)((function*(){if(n.files){for(var t=[],r=0;r<n.files.length;r++)t.push(p(n.files[r]));try{var i=yield Promise.all(t);e({canceled:!1,assets:i,output:n.files})}catch(a){o(a)}}else e({canceled:!0,assets:null});document.body.removeChild(n)}))),n.addEventListener("cancel",(function(){e({canceled:!0,assets:null})}));var t=new MouseEvent("click");n.dispatchEvent(t)}))}));return function(o){return e.apply(this,arguments)}}()};function p(e){return new Promise((function(o,t){var r=e.type,i=new FileReader;i.onerror=function(){t(new Error("Failed to read the selected media because the operation failed."))},i.onload=function(t){var i=t.target.result;o({uri:i,mimeType:r,name:e.name,lastModified:e.lastModified,size:e.size,file:e})},i.readAsDataURL(e)}))}function v(){return v=(0,r.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.type,t=void 0===o?"*/*":o,r=e.copyToCacheDirectory,i=void 0===r||r,a=e.multiple,n=void 0!==a&&a;return"string"===typeof t&&(t=[t]),yield f.getDocumentAsync({type:t,copyToCacheDirectory:i,multiple:n})})),v.apply(this,arguments)}var b=t(1777),h=t(60968),y=t(93335),g=t(38837),m=t(32718),k=t(808),x=t(75400),j=(0,a.createContext)({features:void 0,onekeyFeatures:void 0});function w(){return(0,a.useContext)(j)}var $=t(68743),D=t(34103).StyleSheet.create({0:{flex:1,paddingStart:4}}),M=t(34103).View;t(34103).Text;function C(e){return null==e||""===e.trim()||"unknown"===e.trim()}var S=(0,a.memo)((function(e){var o,t,r=e.field,i=e.value,a=w(),n=a.features,s=a.onekeyFeatures,d=null!=(o=null!=(t=null==s?void 0:s[r])?t:null==n?void 0:n[r])?o:i;return(0,$.jsxs)(x.XStack,{flexWrap:"wrap",width:"100%",$gtLg:{width:"49%"},children:[(0,$.jsx)(l.Text,{minWidth:260,color:C(d)?"$textCritical":"$text",fontSize:18,fontWeight:"bold",children:`${r}: `}),(0,$.jsx)(M,{style:D[0],children:(0,$.jsx)(l.Text,{flex:1,flexWrap:"wrap",fontSize:18,fontWeight:"bold",color:C(d)?"$textCritical":"$text",children:`${null!=d?d:""}`})})]})}),(function(e,o){return e.field===o.field&&e.value===o.value}));t(34103).View,t(34103).Text;function E(e){var o=e.message;return(0,$.jsx)(n.Stack,{padding:"$2",backgroundColor:"$bgCaution",alignItems:"center",children:(0,$.jsx)(l.Text,{children:o})})}var O=t(36111),T=t(28742),I=t(11940),P=t(27294),U=t(5652),R=t(38208),V=t(76005);function B(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,r)}return t}function F(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?B(Object(t),!0).forEach((function(o){(0,O.default)(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var N=t(34103).StyleSheet.create({0:{flexDirection:"column",flex:1,justifyContent:"center",alignItems:"center"}}),L=t(34103).View,H=(t(34103).Text,!1);var W=(0,a.memo)((function(e){var o=e.open,t=e.onOpenChange,r=(0,b.default)(),n=(0,a.useContext)(m.default),s=n.sdk,d=(n.lowLevelSDK,n.type,(0,V.useHardwareInputPinDialog)().openDialog),c=(0,a.useState)({progress:0,message:""}),u=(0,i.default)(c,2),_=u[0],f=u[1];(0,a.useEffect)((function(){f((function(e){return F(F({},e),{},{progress:0})}))}),[o]);var p=(0,a.useCallback)((function(e){var o="";switch(e){case"CheckLatestUiResource":o=r.formatMessage({id:"message__check_latest_ui_resource"});break;case"DownloadLatestUiResource":o=r.formatMessage({id:"message__download_latest_ui_resource"});break;case"DownloadLatestUiResourceSuccess":o=r.formatMessage({id:"message__download_latest_ui_resource_success"});break;case"AutoRebootToBootloader":o=r.formatMessage({id:"message__reboot_to_bootloader"});break;case"GoToBootloaderSuccess":o=r.formatMessage({id:"message__wait_begin_update"});break;case"ConfirmOnDevice":o=r.formatMessage({id:"message__confirm_on_device"});break;case"FirmwareEraseSuccess":o=r.formatMessage({id:"message__firmware_erase_success"});break;case"StartTransferData":o=r.formatMessage({id:"message__firmware_start_transfer"});break;case"InstallingFirmware":o=r.formatMessage({id:"message__firmware_installing"});break;case"UpdateBootloader":o=r.formatMessage({id:"message__bootloader_update"});break;case"UpdateBootloaderSuccess":o=r.formatMessage({id:"message__bootloader_update_success"});break;case"UpdateSysResource":o=r.formatMessage({id:"message__sys_resource_update"});break;case"UpdateSysResourceSuccess":o=r.formatMessage({id:"message__sys_resource_update_success"});break;default:o=e}return o}),[r]);return(0,R.useFocusEffect)((0,a.useCallback)((function(){if(!H&&s){var e=function(e){if(console.log("TopLEVEL EVENT (Firmware Update)===>>>>: ",e),e.type===T.UI_REQUEST.REQUEST_PIN&&d(s,e.payload.device.features),e.type===T.UI_REQUEST.FIRMWARE_TIP){var o=e.payload.data.message;f({progress:0,message:p(o)})}e.type===T.UI_REQUEST.FIRMWARE_PROGRESS&&f((function(o){return F(F({},o),{},{progress:e.payload.progress})}))};return s.on(T.UI_EVENT,e),H=!0,console.log("Firmware Update: register sdk listeners"),function(){console.log("Firmware Update: remove all sdk listeners"),s.off(T.UI_EVENT,e),H=!1}}}),[s,p,d])),(0,$.jsx)(I.Dialog,{open:o,onOpenChange:t,children:(0,$.jsxs)(I.Dialog.Portal,{padding:"$4",children:[(0,$.jsx)(I.Dialog.Overlay,{backgroundColor:"$bgBackdrop"},"overlay"),(0,$.jsxs)(I.Dialog.Content,{minWidth:"100%",minHeight:320,$gtXs:{minWidth:480},children:[(0,$.jsx)(I.Dialog.Title,{children:r.formatMessage({id:"title__updating"})}),(0,$.jsxs)(L,{style:N[0],children:[(0,$.jsx)(l.Text,{height:30,children:_.message}),_.progress>0&&(0,$.jsxs)(l.Text,{height:30,children:[r.formatMessage({id:"label__progress"})," ",_.progress," %"]})]}),(0,$.jsx)(I.Dialog.Close,{asChild:!0,children:(0,$.jsx)(g.Button,{size:"large",children:r.formatMessage({id:"action__close"})})}),(0,$.jsx)(P.Unspaced,{children:(0,$.jsx)(I.Dialog.Close,{asChild:!0,children:(0,$.jsx)(g.Button,{variant:"tertiary",circular:!0,width:32,height:32,position:"absolute",top:"$3",right:"$3",children:(0,$.jsx)(U.X,{})})})})]},"content")]})})}));W.displayName="FirmwareUpdateEvent";var z=t(12528),A=t(55298),K=[["onekey_device_type","onekey_serial_no","onekey_se_type"],["onekey_board_version","onekey_board_hash","onekey_board_build_id"],["onekey_boot_version","onekey_boot_hash","onekey_boot_build_id"],["onekey_firmware_version","onekey_firmware_hash","onekey_firmware_build_id"],["onekey_ble_version","onekey_ble_hash","onekey_ble_build_id","onekey_ble_name"]],Q=[["onekey_se01_version","onekey_se01_hash","onekey_se01_build_id","onekey_se01_state"],["onekey_se01_boot_version","onekey_se01_boot_hash","onekey_se01_boot_build_id"],["onekey_se02_version","onekey_se02_hash","onekey_se02_build_id","onekey_se02_state"],["onekey_se02_boot_version","onekey_se02_boot_hash","onekey_se02_boot_build_id"],["onekey_se03_version","onekey_se03_hash","onekey_se03_build_id","onekey_se03_state"],["onekey_se03_boot_version","onekey_se03_boot_hash","onekey_se03_boot_build_id"],["onekey_se04_version","onekey_se04_hash","onekey_se04_build_id","onekey_se04_state"],["onekey_se04_boot_version","onekey_se04_boot_hash","onekey_se04_boot_build_id"]];function X(e){return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(e)}function G(){var e=(0,b.default)(),o=w(),t=o.features,r=o.onekeyFeatures,i=function(e){var o,i;return null!=(o=null!=(i=null==r?void 0:r[e])?i:null==t?void 0:t[e])?o:""};return(0,$.jsx)(g.Button,{variant:"primary",size:"medium",onPress:function(){var o,a,n,s=[],l=(0,A.getDeviceBasicInfo)(t,r),d=l.deviceType,c=l.serialNumber,u=l.bleVersion,_=l.bootloaderVersion,f=l.boardloaderVersion,p=l.firmwareVersion,v=e.formatMessage({id:!0===(null==t?void 0:t.bootloader_mode)?"label__device_bootloader_statue":"label__device_firmware_status"});s.push(`# Device OneKey ${d} Info (${c})`),s.push(""),s.push(`${e.formatMessage({id:"label__device_type_sdk"})}:    ${d}`),s.push(`${e.formatMessage({id:"label__device_uuid"})}:    ${c}`),s.push(`${e.formatMessage({id:"label__device_device_statue"})}:    ${v}`),s.push(`${e.formatMessage({id:"label__device_boardloader_version"})}:    ${f}`),s.push(`${e.formatMessage({id:"label__device_bootloader_version"})}:    ${_}`),s.push(`${e.formatMessage({id:"label__device_firmware_version"})}:    ${p}`),s.push(`${e.formatMessage({id:"label__device_bluetooth_version"})}:    ${u}`),s.push(""),s.push(""),s.push("## Device Info"),K.forEach((function(e){e.forEach((function(e){var o=i(e);s.push(`${e}:    ${o}`)})),s.push("")})),s.push(""),s.push(""),s.push("## Device SE Info"),Q.forEach((function(e){e.forEach((function(e){var o=i(e);s.push(`${e}:    ${o}`)})),s.push("")})),s.push("");var b=null==(o=X(Date.now()))||null==(a=o.replace(/:/g,""))||null==(n=a.replace(/\//g,""))?void 0:n.replace(/ /g,"-"),h=`${d}-${c}-${b}.txt`;!0===t.bootloader_mode&&(h=`${d}-bootloader-${c}-${b}.txt`),(0,z.downloadFile)(h,s.join("\n").toString())},children:e.formatMessage({id:"label__device_info_export"})})}t(34103).View,t(34103).Text;function Y(e){var o=e.children;return(0,$.jsx)(x.XStack,{flex:1,padding:"$2",backgroundColor:"$bgHover",gap:"$2",borderRadius:"$2",flexWrap:"wrap",children:o})}function q(){return K.map((function(e,o){return(0,$.jsx)(Y,{children:e.map((function(e){return(0,$.jsx)(S,{field:e},e)}))},o)}))}function J(){return Q.map((function(e,o){return(0,$.jsx)(Y,{children:e.map((function(e){return(0,$.jsx)(S,{field:e},e)}))},o)}))}var Z=t(34103).StyleSheet.create({0:{flexDirection:"row",alignItems:"center"},1:{marginTop:8},2:{flexDirection:"row",paddingTop:8,paddingRight:8,paddingBottom:8,paddingLeft:8,alignItems:"center",gap:32},3:{flexDirection:"row",flexWrap:"wrap",gap:8},4:{paddingTop:8,paddingRight:8,paddingBottom:8,paddingLeft:8}}),ee=t(34103).View;t(34103).Text;function oe(e){var o=e.title,t=e.onUpdate,d=(e.deviceType,(0,b.default)()),c=(0,a.useState)(),u=(0,i.default)(c,2),_=u[0],f=u[1];return(0,$.jsxs)(n.Stack,{padding:"$2",gap:"$2",borderColor:"$border",borderWidth:"$px",borderRadius:"$3",width:"100%",flex:1,$gtSm:{width:"48%"},$gtLg:{width:"30%"},children:[(0,$.jsx)(s.H5,{children:o}),(0,$.jsx)(g.Button,{variant:"primary",size:"large",onPress:(0,r.default)((function*(){f(void 0);var e=yield null==t?void 0:t();f(e)})),children:d.formatMessage({id:"label__reboot_device_board_model"})}),_&&(0,$.jsx)(l.Text,{color:null!=_&&_.success?"$text":"$textCritical",children:null!=_&&_.success?d.formatMessage({id:"tip__update_success"}):null==_?void 0:_.payload})]})}function te(e){var o=e.title,t=e.type,_=e.onUpdate,f=e.deviceType,p=(0,b.default)(),h=(0,a.useState)(null),y=(0,i.default)(h,2),m=y[0],k=y[1],x=(0,a.useState)(),j=(0,i.default)(x,2),w=j[0],D=j[1],M=(0,a.useState)(!0),C=(0,i.default)(M,2),S=C[0],E=C[1];return(0,$.jsxs)(n.Stack,{padding:"$2",gap:"$2",borderColor:"$border",borderWidth:"$px",borderRadius:"$3",width:"100%",flex:1,$gtSm:{width:"48%"},$gtLg:{width:"30%"},children:[(0,$.jsx)(s.H5,{children:o}),(0,$.jsxs)(n.Stack,{flex:1,padding:"$2",backgroundColor:"$bgHover",gap:"$2",flexDirection:"row",flexWrap:"wrap",borderRadius:"$2",alignItems:"center",justifyContent:"space-between",children:[(0,$.jsx)(l.Text,{children:null!=m&&m.name?null==m?void 0:m.name:p.formatMessage({id:"tip__no_select_file"})}),(0,$.jsx)(g.Button,{onPress:function(){(function(){return v.apply(this,arguments)})({type:"source"===t?"application/zip":"application/octet-stream"}).then((function(e){e.canceled||(0===e.assets.length?alert(p.formatMessage({id:"tip__no_select_file_tip"})):k(e.assets[0]))}))},children:p.formatMessage({id:"action__pick_file"})})]}),"pro"!==f&&"touch"!==f||"firmware"!==t?null:(0,$.jsxs)(ee,{style:Z[0],children:[(0,$.jsx)(d.Checkbox,{checked:S,onCheckedChange:function(e){return E(!!e)},children:(0,$.jsx)(d.Checkbox.Indicator,{children:(0,$.jsx)(u.Check,{})})}),(0,$.jsx)(c.Label,{paddingRight:"$0",justifyContent:"flex-end",children:p.formatMessage({id:"label__reboot_device_after_update"})})]}),(0,$.jsx)(g.Button,{variant:"primary",size:"large",disabled:!m,onPress:(0,r.default)((function*(){D(void 0);var e=yield null==_?void 0:_({type:t,file:m,reboot:S});D(e)})),children:p.formatMessage({id:"action__update"})}),w&&(0,$.jsx)(l.Text,{color:null!=w&&w.success?"$text":"$textCritical",children:null!=w&&w.success?p.formatMessage({id:"tip__update_success"}):null==w?void 0:w.payload})]})}function re(e){var o=e.selectDevice,t=e.onDisconnectDevice,s=e.onReconnectDevice,d=(0,b.default)(),c=(0,a.useContext)(m.default).sdk,u=(0,a.useState)(void 0),_=(0,i.default)(u,2),f=_[0],p=_[1],v=(0,a.useState)(void 0),h=(0,i.default)(v,2),k=h[0],x=h[1],w=(0,a.useState)(!1),D=(0,i.default)(w,2),M=D[0],C=D[1],O=(0,a.useState)(void 0),T=(0,i.default)(O,2),I=T[0],P=T[1],U=(0,a.useState)(!1),R=(0,i.default)(U,2),B=R[0],F=R[1],N=(0,A.getDeviceBasicInfo)(f,k),L=N.deviceType,H=N.serialNumber,z=N.bleVersion,K=N.bootloaderVersion,Q=N.boardloaderVersion,Y=N.firmwareVersion,re=L.toLowerCase(),ie=(0,a.useCallback)((function(){c&&c.getOnekeyFeatures(null==o?void 0:o.connectId).then((function(e){e.success?x(e.payload):x(void 0)}))}),[c,null==o?void 0:o.connectId]);(0,a.useEffect)((function(){if(c){if(null==(null==o?void 0:o.connectId)||null==(null==o?void 0:o.features))return p(void 0),void x(void 0);C(!0),p(void 0),c.getFeatures(null==o?void 0:o.connectId).then((function(e){e.success?(p(e.payload),ie()):P(e.payload.error)})).catch((function(e){P(e.message)})).finally((function(){C(!1)}))}}),[ie,c,null==o?void 0:o.connectId,null==o?void 0:o.features]);var ae=(0,a.useCallback)((function(){p(void 0),null==t||t()}),[t]),ne=(0,a.useCallback)(function(){var e=(0,r.default)((function*(e){var t,r,i=e.type,a=e.file,n=e.reboot;if(!c)return{payload:d.formatMessage({id:"tip__sdk_not_ready"}),success:!1};if(!f)return{payload:"features is not ready",success:!1};if(!o)return{payload:d.formatMessage({id:"tip__need_connect_device_first"}),success:!1};if(!(t=yield null==(r=a.file)?void 0:r.arrayBuffer()))return{payload:d.formatMessage({id:"tip__need_pick_file"}),success:!1};if("bootloader"===i&&("touch"===re||"pro"===re)){F(!0);var s=yield c.deviceUpdateBootloader(o.connectId,{binary:t});return F(!1),s.success?{success:!0}:{success:!1,payload:s.payload.error}}if("ble"===i||"firmware"===i||"bootloader"===i){F(!0);var l=yield c.firmwareUpdate(void 0,{updateType:"bootloader"===i?"firmware":i,binary:t,rebootOnSuccess:n});return F(!1),l.success?{success:!0}:{success:!1,payload:l.payload.error}}if("source"===i){F(!0);var u=yield c.deviceFullyUploadResource(o.connectId,{binary:t});return F(!1),u.success?{success:!0}:{success:!1,payload:u.payload.error}}}));return function(o){return e.apply(this,arguments)}}(),[re,f,d,c,o]),se=(0,a.useCallback)((0,r.default)((function*(){if(c&&f&&o){var e=yield c.deviceRebootToBoardloader(o.connectId);return e.success?{success:!0}:{success:!1,payload:e.payload.error}}})),[f,c,o]),le=(0,a.useMemo)((function(){return{features:f,onekeyFeatures:k}}),[f,k]);return(0,$.jsx)(V.HardwareInputPinDialogProvider,{children:(0,$.jsxs)(ee,{style:[],children:[(0,$.jsx)(W,{open:B,onOpenChange:F}),(0,$.jsxs)(ee,{style:Z[1],children:[M&&(0,$.jsx)(E,{message:d.formatMessage({id:"tip__connecting_device"})}),!o&&(0,$.jsx)(E,{message:d.formatMessage({id:"tip__need_connect_and_search_device_first"})}),!!I&&(0,$.jsx)(E,{message:I})]}),f&&(0,$.jsxs)(ee,{style:[],children:[(0,$.jsxs)(y.default,{title:d.formatMessage({id:"title__device_info"}),children:[(0,$.jsx)(g.Button,{variant:"primary",size:"large",onPress:ae,children:d.formatMessage({id:"action__clean_device"})}),(0,$.jsxs)(n.Stack,{flex:1,padding:"$2",backgroundColor:"$bgHover",gap:"$2",flexDirection:"row",flexWrap:"wrap",borderRadius:"$2",children:[(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_type_sdk"}),value:L}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_uuid"}),value:H}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_boardloader_version"}),value:Q}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_bootloader_version"}),value:K}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_firmware_version"}),value:Y}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_bluetooth_version"}),value:z}),(0,$.jsx)(S,{field:d.formatMessage({id:"label__device_device_statue"}),value:d.formatMessage({id:!0===f.bootloader_mode?"label__device_bootloader_statue":"label__device_firmware_status"})})]})]}),(0,$.jsx)(j.Provider,{value:le,children:(0,$.jsxs)(y.default,{title:d.formatMessage({id:"title__device_advanced_info"}),children:[(0,$.jsxs)(ee,{style:Z[2],children:[(0,$.jsxs)(l.Text,{color:"$text",fontSize:18,fontWeight:"bold",children:[d.formatMessage({id:"label__device_info_update_time"}),":",X(Date.now())]}),(0,$.jsx)(g.Button,{variant:"primary",size:"medium",onPress:s,children:d.formatMessage({id:"label__device_info_refresh"})}),(0,$.jsx)(G,{})]}),(0,$.jsx)(q,{}),(0,$.jsx)(l.Text,{padding:8,fontWeight:"bold",children:d.formatMessage({id:"label__device_se_info"})}),(0,$.jsx)(J,{})]})}),(0,$.jsx)(y.default,{title:d.formatMessage({id:"title__device_firmware_update"}),children:(0,$.jsxs)(ee,{style:Z[3],children:[(0,$.jsx)(te,{deviceType:re,title:d.formatMessage({id:"label__device_update_firmware"}),type:"firmware",onUpdate:ne}),"mini"!==re&&(0,$.jsx)(te,{deviceType:re,title:d.formatMessage({id:"label__device_update_ble_firmware"}),type:"firmware",onUpdate:ne}),(0,$.jsx)(te,{deviceType:re,title:d.formatMessage({id:"label__device_update_bootloader"}),type:"bootloader",onUpdate:ne}),("pro"===re||"touch"===re)&&(0,$.jsx)(te,{deviceType:re,title:d.formatMessage({id:"label__device_update_sys_resource"}),type:"source",onUpdate:ne}),("pro"===re||"touch"===re)&&(0,$.jsx)(oe,{deviceType:re,title:d.formatMessage({id:"label__reboot_device_board_model"}),onUpdate:se})]})})]})]})})}function ie(){var e=(0,a.useState)(void 0),o=(0,i.default)(e,2),t=o[0],r=o[1],n=(0,a.useRef)(null);return(0,$.jsx)(h.default,{children:(0,$.jsxs)(ee,{style:Z[4],children:[(0,$.jsx)(k.DeviceList,{ref:n,onSelected:r,disableSaveDevice:!0}),(0,$.jsx)(re,{selectDevice:t,onDisconnectDevice:function(){return r(void 0)},onReconnectDevice:function(){var e;null==(e=n.current)||e.searchDevices()}})]})})}}}]);